<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="description" content="Single-file Swagger UI viewer for OpenAPI specifications. Upload YAML/JSON files and render API documentation instantly."/>
  <meta name="keywords" content="OpenAPI, Swagger, API documentation, YAML, JSON, viewer"/>
  <meta name="author" content="Garry OpenAPI Swagger Viewer"/>
  
  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://unpkg.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://unpkg.com https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https:;"/>
  <meta http-equiv="X-Content-Type-Options" content="nosniff"/>
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN"/>
  <meta http-equiv="X-XSS-Protection" content="1; mode=block"/>
  
  <title>OpenAPI Viewer – Swagger UI</title>

  <!-- Tailwind (CDN) - Pinned version -->
  <script src="https://cdn.tailwindcss.com/3.4.1"></script>

  <!-- Icons (Font Awesome CDN) - Pinned version -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <!-- Swagger UI (CDN) - Pinned version -->
  <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5.17.14/swagger-ui.css" />

  <!-- YAML parser (CDN) - Pinned version -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js" integrity="sha512-pu1YVJjN3zW3f0X7f0T3vN3N3JSY3W9fQ5Tt3f8J6Zmgx1B1v8Y5YFv5z5F5F5F5F5F5F5F5F5F5F5F5F5F5F5F5F5F==" crossorigin="anonymous"></script>

  <style>
    :root{
      --li-blue:#0A66C2;
      --li-blue-2:#0b5cad;
      --li-bg:#F3F6F8;
      --li-card:#FFFFFF;
      --li-text:#1f2937;
      --li-muted:#6b7280;
      --li-border:#e5e7eb;
    }
    body{ background:var(--li-bg); color:var(--li-text); }
    /* Swagger tweaks to feel "LinkedIn-ish" */
    .swagger-ui .topbar{ display:none; }
    .swagger-ui .info .title{ color:var(--li-text); font-weight:800; }
    .swagger-ui .info a{ color:var(--li-blue); }
    .swagger-ui .btn.authorize{ background:var(--li-blue); border-color:var(--li-blue); }
    .swagger-ui .btn.authorize:hover{ background:var(--li-blue-2); border-color:var(--li-blue-2); }
    .swagger-ui .opblock.opblock-get .opblock-summary-method{ background:#2563eb; }
    .swagger-ui .opblock.opblock-post .opblock-summary-method{ background:#16a34a; }
    .swagger-ui .opblock.opblock-put .opblock-summary-method{ background:#f59e0b; }
    .swagger-ui .opblock.opblock-delete .opblock-summary-method{ background:#dc2626; }
    .swagger-ui .opblock{ border:1px solid var(--li-border); border-radius:12px; box-shadow:0 1px 2px rgba(0,0,0,.04); }
    .swagger-ui .opblock .opblock-summary{ border-bottom:1px solid var(--li-border); }
    .swagger-ui .scheme-container{ background:transparent; box-shadow:none; padding:0; }
    .swagger-ui .wrapper{ max-width:1200px; }
    .swagger-ui .opblock-tag{ border-bottom:1px solid var(--li-border); }
    .swagger-ui .opblock-tag:hover{ background:rgba(10,102,194,0.05); }
    .swagger-ui .responses-inner{ border-top:1px solid var(--li-border); }
    .swagger-ui select{ border-radius:10px !important; }
    .swagger-ui input[type="text"], .swagger-ui input[type="password"], .swagger-ui textarea{
      border-radius:10px !important; border:1px solid var(--li-border) !important;
    }
    .swagger-ui .btn{ border-radius:10px !important; }
    /* make the swagger "card" blend */
    #swagger-root{ background:var(--li-card); border:1px solid var(--li-border); border-radius:16px; }
  </style>
</head>

<body class="min-h-screen">
  <!-- Header -->
  <header class="sticky top-0 z-20 backdrop-blur bg-white/80 border-b border-slate-200">
    <div class="max-w-[1200px] mx-auto px-4 py-3 flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl flex items-center justify-center text-white" style="background:#0A66C2;">
          <i class="fa-solid fa-diagram-project"></i>
        </div>
        <div>
          <div class="text-lg font-extrabold leading-tight">OpenAPI Swagger Viewer</div>
          <div class="text-xs text-slate-500">Single-file UI · Upload OpenAPI YAML/JSON · Swagger UI render</div>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <button id="btnSample"
          class="px-3 py-2 rounded-xl text-sm font-semibold border border-slate-200 bg-white hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
          aria-label="Load sample OpenAPI specification">
          <i class="fa-solid fa-pizza-slice mr-2 text-slate-600" aria-hidden="true"></i>Load Sample
        </button>
        <a href="https://swagger.io/tools/swagger-ui/" target="_blank" rel="noreferrer noopener"
          class="px-3 py-2 rounded-xl text-sm font-semibold text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
          style="background:#0A66C2;"
          aria-label="Learn more about Swagger UI (opens in new tab)">
          <i class="fa-solid fa-circle-info mr-2" aria-hidden="true"></i>About Swagger UI
        </a>
      </div>
    </div>
  </header>

  <!-- Controls -->
  <main class="max-w-[1200px] mx-auto px-4 py-6">
    <section class="bg-white border border-slate-200 rounded-2xl p-4 md:p-5 shadow-sm">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div class="flex items-start gap-3">
          <div class="mt-1 h-9 w-9 rounded-xl flex items-center justify-center bg-slate-100 text-slate-700">
            <i class="fa-solid fa-upload"></i>
          </div>
          <div>
            <div class="font-bold">Upload OpenAPI file</div>
            <div class="text-sm text-slate-500">
              Supports <span class="font-semibold">.yaml / .yml / .json</span>. No server needed — runs fully in browser.
            </div>
          </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-2 sm:items-center">
          <label class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 cursor-pointer focus-within:outline-none focus-within:ring-2 focus-within:ring-blue-500 focus-within:ring-offset-2">
            <i class="fa-regular fa-file-lines text-slate-600" aria-hidden="true"></i>
            <span class="text-sm font-semibold">Choose file</span>
            <input id="fileInput" type="file" class="hidden" accept=".yaml,.yml,.json,application/yaml,application/json,text/yaml,text/plain" aria-label="Select OpenAPI specification file"/>
          </label>

          <button id="btnClear"
            class="px-3 py-2 rounded-xl text-sm font-semibold border border-slate-200 bg-white hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
            aria-label="Clear loaded specification">
            <i class="fa-solid fa-broom mr-2 text-slate-600" aria-hidden="true"></i>Clear
          </button>
        </div>
      </div>

      <div class="mt-3">
        <div id="status" class="text-sm text-slate-600" role="status" aria-live="polite"></div>
        <div id="errorBox" class="hidden mt-3 p-3 rounded-xl border border-red-200 bg-red-50 text-red-800 text-sm" role="alert" aria-live="assertive"></div>
        <div id="loadingIndicator" class="hidden mt-3">
          <div class="flex items-center gap-2 text-sm text-slate-600">
            <i class="fa-solid fa-spinner fa-spin" aria-hidden="true"></i>
            <span>Processing...</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Swagger Container -->
    <section class="mt-6" id="swagger-root">
      <div class="p-4 border-b border-slate-200 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <i class="fa-solid fa-book text-slate-600"></i>
          <div class="font-bold">API Documentation</div>
        </div>
        <div class="text-xs text-slate-500">Tip: Use “Load Sample” to see it instantly</div>
      </div>
      <div id="swagger-ui" class="p-0"></div>
    </section>

    <footer class="py-8 text-center text-xs text-slate-500">
      Built as a tiny dev utility · Tailwind + Swagger UI via CDN · No build step
    </footer>
  </main>

  <!-- Swagger UI bundle - Pinned versions -->
  <script src="https://unpkg.com/swagger-ui-dist@5.17.14/swagger-ui-bundle.js"></script>
  <script src="https://unpkg.com/swagger-ui-dist@5.17.14/swagger-ui-standalone-preset.js"></script>

  <script>
    'use strict';
    
    const $ = (id) => document.getElementById(id);

    const statusEl = $("status");
    const errorBox = $("errorBox");
    const loadingIndicator = $("loadingIndicator");
    const fileInput = $("fileInput");
    const btnClear = $("btnClear");
    const btnSample = $("btnSample");

    let ui = null;
    const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB limit

    function setStatus(msg){ 
      statusEl.textContent = msg || ""; 
      statusEl.setAttribute('aria-live', msg ? 'polite' : 'off');
    }
    
    function showError(msg){
      if(!msg){ 
        errorBox.classList.add("hidden"); 
        errorBox.textContent=""; 
        errorBox.setAttribute('aria-live', 'off');
        return; 
      }
      errorBox.classList.remove("hidden");
      errorBox.textContent = msg;
      errorBox.setAttribute('aria-live', 'assertive');
    }
    
    function showLoading(show){
      if(show){
        loadingIndicator.classList.remove("hidden");
      } else {
        loadingIndicator.classList.add("hidden");
      }
    }
    
    function validateOpenAPISpec(spec){
      if(!spec || typeof spec !== 'object'){
        throw new Error("Invalid specification: must be an object");
      }
      
      // Basic OpenAPI 3.x validation
      if(!spec.openapi && !spec.swagger){
        throw new Error("Invalid OpenAPI specification: missing 'openapi' or 'swagger' field");
      }
      
      const version = spec.openapi || spec.swagger;
      if(spec.openapi && !version.startsWith('3.')){
        throw new Error(`Unsupported OpenAPI version: ${version}. This viewer supports OpenAPI 3.x`);
      }
      
      if(!spec.info || !spec.info.title){
        throw new Error("Invalid OpenAPI specification: missing 'info.title'");
      }
      
      return true;
    }

    function initSwagger(spec){
      try {
        // Validate spec before rendering
        validateOpenAPISpec(spec);
        
        // Cleanup existing UI
        const container = document.querySelector("#swagger-ui");
        if(!container){
          throw new Error("Swagger UI container not found");
        }
        container.innerHTML = "";

        ui = SwaggerUIBundle({
          spec,
          dom_id: "#swagger-ui",
          deepLinking: true,
          presets: [SwaggerUIBundle.presets.apis, SwaggerUIStandalonePreset],
          layout: "BaseLayout",
          tryItOutEnabled: true,
          displayRequestDuration: true,
          filter: true,
          validatorUrl: null, // Disable online validator for offline use
          onComplete: function(){
            setStatus("Specification rendered successfully");
            showLoading(false);
          },
          onFailure: function(err){
            showError("Failed to render Swagger UI: " + (err.message || "Unknown error"));
            showLoading(false);
          }
        });

        window.ui = ui;
      } catch(err){
        throw new Error("Failed to initialize Swagger UI: " + err.message);
      }
    }

    function parseSpecText(text, filename){
      const lower = (filename || "").toLowerCase();
      try{
        if(lower.endsWith(".json")){
          return JSON.parse(text);
        }
        // yaml or yml, or unknown -> attempt yaml then json
        try{
          return jsyaml.load(text);
        }catch(yamlErr){
          return JSON.parse(text);
        }
      }catch(err){
        throw new Error("Unable to parse file. Make sure it is valid OpenAPI YAML or JSON. Details: " + err.message);
      }
    }

    async function loadSample(){
      setStatus("Loading sample spec (pizza-store.yaml) …");
      showError(null);
      showLoading(true);
      
      try{
        const res = await fetch("./pizza-store.yaml", { 
          cache: "no-store",
          headers: {
            'Accept': 'text/yaml, application/yaml, text/plain, */*'
          }
        });
        
        if(!res.ok){
          throw new Error(`HTTP ${res.status}: Could not fetch sample file. If you opened the HTML via file://, run a local server (e.g., python3 -m http.server 8080).`);
        }
        
        const text = await res.text();
        if(!text || text.trim().length === 0){
          throw new Error("Sample file is empty");
        }
        
        const spec = parseSpecText(text, "pizza-store.yaml");
        initSwagger(spec);
        setStatus("Sample loaded: pizza-store.yaml");
      }catch(err){
        showError(
          "Sample load failed.\n" +
          "Fix: Run a local server.\n" +
          "Example: python3 -m http.server 8080\n\n" +
          "Error: " + err.message
        );
        setStatus("");
        showLoading(false);
      }
    }

    fileInput.addEventListener("change", async (e) => {
      const file = e.target.files && e.target.files[0];
      if(!file) return;

      // Validate file size
      if(file.size > MAX_FILE_SIZE){
        showError(`File too large. Maximum size is ${MAX_FILE_SIZE / 1024 / 1024}MB. Your file is ${(file.size / 1024 / 1024).toFixed(2)}MB.`);
        fileInput.value = "";
        setStatus("");
        return;
      }

      setStatus(`Reading: ${file.name} …`);
      showError(null);
      showLoading(true);

      const reader = new FileReader();
      reader.onload = () => {
        try{
          const text = String(reader.result || "");
          if(!text || text.trim().length === 0){
            throw new Error("File is empty");
          }
          
          const spec = parseSpecText(text, file.name);
          initSwagger(spec);
          setStatus(`Rendered: ${file.name}`);
        }catch(err){
          showError(err.message);
          setStatus("");
          showLoading(false);
        }
      };
      reader.onerror = () => {
        showError("Failed to read file. Please try again.");
        setStatus("");
        showLoading(false);
      };
      reader.onabort = () => {
        showError("File reading was cancelled.");
        setStatus("");
        showLoading(false);
      };
      reader.readAsText(file);
    });

    btnClear.addEventListener("click", () => {
      fileInput.value = "";
      showError(null);
      showLoading(false);
      setStatus("Cleared. Upload a file or load sample.");
      
      const container = document.querySelector("#swagger-ui");
      if(container){
        container.innerHTML = `
          <div class="p-6 text-sm text-slate-600">
            <div class="font-semibold mb-1">No spec loaded</div>
            <div>Upload an OpenAPI YAML/JSON file, or click <span class="font-semibold">Load Sample</span>.</div>
          </div>`;
      }
      
      if(ui && typeof ui.getSystem === 'function'){
        try {
          ui = null;
          window.ui = null;
        } catch(e){
          // Ignore cleanup errors
        }
      }
    });

    btnSample.addEventListener("click", loadSample);
    
    // Keyboard shortcuts
    document.addEventListener("keydown", (e) => {
      // Ctrl/Cmd + O to open file
      if((e.ctrlKey || e.metaKey) && e.key === 'o'){
        e.preventDefault();
        fileInput.click();
      }
      // Escape to clear
      if(e.key === 'Escape' && fileInput.value){
        btnClear.click();
      }
    });
    
    // Handle page visibility changes
    document.addEventListener("visibilitychange", () => {
      if(document.hidden){
        // Pause any ongoing operations if needed
      }
    });
    
    // Error boundary for unhandled errors
    window.addEventListener("error", (e) => {
      console.error("Unhandled error:", e.error);
      if(!errorBox.textContent){
        showError("An unexpected error occurred. Please refresh the page and try again.");
      }
    });
    
    window.addEventListener("unhandledrejection", (e) => {
      console.error("Unhandled promise rejection:", e.reason);
      if(!errorBox.textContent){
        showError("An unexpected error occurred. Please refresh the page and try again.");
      }
    });

    // Initial empty state
    btnClear.click();
  </script>
</body>
</html>
